!function(n,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.flicWebSocketClient=e():n.flicWebSocketClient=e()}(this,function(){return function(n){function e(o){if(t[o])return t[o].exports;var a=t[o]={i:o,l:!1,exports:{}};return n[o].call(a.exports,a,a.exports,e),a.l=!0,a.exports}var t={};return e.m=n,e.c=t,e.i=function(n){return n},e.d=function(n,t,o){e.o(n,t)||Object.defineProperty(n,t,{configurable:!1,enumerable:!0,get:o})},e.n=function(n){var t=n&&n.__esModule?function(){return n.default}:function(){return n};return e.d(t,"a",t),t},e.o=function(n,e){return Object.prototype.hasOwnProperty.call(n,e)},e.p="",e(e.s=1)}([function(n,e){var t={GetInfo:0,CreateScanner:1,RemoveScanner:2,CreateConnectionChannel:3,RemoveConnectionChannel:4,ForceDisconnect:5,ChangeModeParameters:6,Ping:7,GetButtonUUID:8,CreateScanWizard:9,CancelScanWizard:10},o={AdvertisementPacket:0,CreateConnectionChannelResponse:1,ConnectionStatusChanged:2,ConnectionChannelRemoved:3,ButtonUpOrDown:4,ButtonClickOrHold:5,ButtonSingleOrDoubleClick:6,ButtonSingleOrDoubleClickOrHold:7,NewVerifiedButton:8,GetInfoResponse:9,NoSpaceForNewConnection:10,GotSpaceForNewConnection:11,BluetoothControllerStateChange:12,PingResponse:13,GetButtonUUIDResponse:14,ScanWizardFoundPrivateButton:15,ScanWizardFoundPublicButton:16,ScanWizardButtonConnected:17,ScanWizardCompleted:18},a=function(n){function e(n){u.onWsOpen(n)}function a(n){u.onWsClose(n)}function c(n){console.log("Warning: "+n.data)}function r(n){function e(){return l[C++]}function t(){return l[C++]|l[C++]<<8}function a(){return t()|t()<<16}function c(){for(var n="",e=5;e>=0;e--)n+=(256+l[C+e]).toString(16).substr(-2),0!=e&&(n+=":");return C+=6,n}function r(){var t=e(),o=new TextDecoder("utf-8").decode(new Uint8Array(n.data,C,t));return C+=16,o}function d(){return 0!=e()}function s(n){var t=e(),o=i[n];for(var a in o)if(o.hasOwnProperty(a)&&o[a]==t)return a}var l=new Uint8Array(n.data),C=0,f=e();switch(f){case o.AdvertisementPacket:var h={scanId:a(),bdAddr:c(),name:r(),rssi:function(){return e()<<24>>24}(),isPrivate:d(),alreadyVerified:d()};u.onEvent(f,h);break;case o.CreateConnectionChannelResponse:var h={connId:a(),error:s("CreateConnectionChannelError"),connectionStatus:s("ConnectionStatus")};u.onEvent(f,h);break;case o.ConnectionStatusChanged:var h={connId:a(),connectionStatus:s("ConnectionStatus"),disconnectReason:s("DisconnectReason")};u.onEvent(f,h);break;case o.ConnectionChannelRemoved:var h={connId:a(),removedReason:s("RemovedReason")};u.onEvent(f,h);break;case o.ButtonUpOrDown:case o.ButtonClickOrHold:case o.ButtonSingleOrDoubleClick:case o.ButtonSingleOrDoubleClickOrHold:var h={connId:a(),clickType:s("ClickType"),wasQueued:d(),timeDiff:a()};u.onEvent(f,h);break;case o.NewVerifiedButton:var h={bdAddr:c()};u.onEvent(f,h);break;case o.GetInfoResponse:for(var h={bluetoothControllerState:s("BluetoothControllerState"),myBdAddr:c(),myBdAddrType:s("BdAddrType"),maxPendingConnections:e(),maxConcurrentlyConnectedButtons:function(){return t()<<16>>16}(),currentPendingConnections:e(),currentlyNoSpaceForNewConnection:d(),bdAddrOfVerifiedButtons:new Array(t())},v=0;v<h.bdAddrOfVerifiedButtons.length;v++)h.bdAddrOfVerifiedButtons[v]=c();u.onEvent(f,h);break;case o.NoSpaceForNewConnection:case o.GotSpaceForNewConnection:var h={maxConcurrentlyConnectedButtons:e()};u.onEvent(f,h);break;case o.BluetoothControllerStateChange:var h={state:s("BluetoothControllerState")};u.onEvent(f,h);break;case o.PingResponse:var h={pingId:a()};u.onEvent(f,h);break;case o.GetButtonUUIDResponse:var h={bdAddr:c(),uuid:function(){for(var n="",e=0;e<16;e++)n+=(256+l[C+e]).toString(16).substr(-2);return C+=16,"00000000000000000000000000000000"==n&&(n=null),n}()};u.onEvent(f,h);break;case o.ScanWizardFoundPrivateButton:case o.ScanWizardButtonConnected:var h={scanWizardId:a()};u.onEvent(f,h);break;case o.ScanWizardFoundPublicButton:var h={scanWizardId:a(),bdAddr:c(),name:r()};u.onEvent(f,h);break;case o.ScanWizardCompleted:var h={scanWizardId:a(),result:s("ScanWizardResult")};u.onEvent(f,h)}}var i={CreateConnectionChannelError:{NoError:0,MaxPendingConnectionsReached:1},ConnectionStatus:{Disconnected:0,Connected:1,Ready:2},DisconnectReason:{Unspecified:0,ConnectionEstablishmentFailed:1,TimedOut:2,BondingKeysMismatch:3},RemovedReason:{RemovedByThisClient:0,ForceDisconnectedByThisClient:1,ForceDisconnectedByOtherClient:2,ButtonIsPrivate:3,VerifyTimeout:4,InternetBackendError:5,InvalidData:6,CouldntLoadDevice:7},ClickType:{ButtonDown:0,ButtonUp:1,ButtonClick:2,ButtonSingleClick:3,ButtonDoubleClick:4,ButtonHold:5},BdAddrType:{PublicBdAddrType:0,RandomBdAddrType:1},LatencyMode:{NormalLatency:0,LowLatency:1,HighLatency:2},ScanWizardResult:{WizardSuccess:0,WizardCancelledByUser:1,WizardFailedTimeout:2,WizardButtonIsPrivate:3,WizardBluetoothUnavailable:4,WizardInternetBackendError:5,WizardInvalidData:6},BluetoothControllerState:{Detached:0,Resetting:1,Attached:2}},d=new WebSocket(n);d.binaryType="arraybuffer",d.onopen=e,d.onclose=a,d.onmessage=r,d.onerror=c;var u=this;this.sendCommand=function(n,e){function o(n){l[C++]=n}function a(n){l[C++]=n,l[C++]=n>>8}function c(n){a(n),a(n>>16)}function r(n){for(var e=15;e>=0;e-=3)o(parseInt(n.substr(e,2),16))}function u(n,e){o(i[n][e])}var s=new ArrayBuffer(100),l=new Uint8Array(s),C=0;switch(o(n),n){case t.GetInfo:break;case t.CreateScanner:case t.RemoveScanner:c(e.scanId);break;case t.CreateConnectionChannel:c(e.connId),r(e.bdAddr),u("LatencyMode",e.latencyMode),a(e.autoDisconnectTime);break;case t.RemoveConnectionChannel:c(e.connId);break;case t.ForceDisconnect:case t.GetButtonUUID:r(e.bdAddr);break;case t.ChangeModeParameters:c(e.connId),u("LatencyMode",e.latencyMode),a(e.autoDisconnectTime);break;case t.Ping:c(e.pingId);break;case t.CreateScanWizard:case t.CancelScanWizard:c(e.scanWizardId);break;default:return}d.send(new Uint8Array(s,0,C))},this.onWsOpen=function(n){},this.onWsClose=function(n){},this.onEvent=function(n,e){}},c=function(){var n=0;return function(e,a){a=a||{};var c=c in a?a.latencyMode:"NormalLatency",r=r in a?a.autoDisconnectTime:511,i=a.onCreateResponse||function(n,e){},d=a.onRemoved||function(n){},u=a.onConnectionStatusChanged||function(n,e){},s=a.onButtonUpOrDown||function(n,e,t){},l=a.onButtonClickOrHold||function(n,e,t){},C=a.onButtonSingleOrDoubleClick||function(n,e,t){},f=a.onButtonSingleOrDoubleClickOrHold||function(n,e,t){},h=n++,v=null;this._getId=function(){return h},this._attach=function(n){v=n,n.sendCommand(t.CreateConnectionChannel,{connId:h,bdAddr:e,latencyMode:c,autoDisconnectTime:r})},this._detach=function(n){n.sendCommand(t.RemoveConnectionChannel,{connId:h})},this._detached=function(){v=null},this._onEvent=function(n,e){switch(n){case o.CreateConnectionChannelResponse:i(e.error,e.connectionStatus);break;case o.ConnectionStatusChanged:u(e.connectionStatus,e.disconnectReason);break;case o.ConnectionChannelRemoved:d(e.removedReason);break;case o.ButtonUpOrDown:s(e.clickType,e.wasQueued,e.timeDiff);break;case o.ButtonClickOrHold:l(e.clickType,e.wasQueued,e.timeDiff);break;case o.ButtonSingleOrDoubleClick:C(e.clickType,e.wasQueued,e.timeDiff);break;case o.ButtonSingleOrDoubleClickOrHold:f(e.clickType,e.wasQueued,e.timeDiff)}},Object.defineProperty(this,"latencyMode",{get:function(){return c},set:function(n){c=n,null!=v&&v.sendCommand(t.ChangeModeParameters,{connId:h,latencyMode:c,autoDisconnectTime:r})}}),Object.defineProperty(this,"autoDisconnectTime",{get:function(){return r},set:function(n){r=n,null!=v&&v.sendCommand(t.ChangeModeParameters,{connId:h,latencyMode:c,autoDisconnectTime:r})}})}}(),r=function(){var n=0;return function(e){e=e||{};var a=e.onAdvertisementPacket||function(n,e,t,o,a){},c=n++;this._getId=function(){return c},this._attach=function(n){n.sendCommand(t.CreateScanner,{scanId:c})},this._detach=function(n){n.sendCommand(t.RemoveScanner,{scanId:c})},this._onEvent=function(n,e){switch(n){case o.AdvertisementPacket:a(e.bdAddr,e.name,e.rssi,e.isPrivate,e.alreadyVerified)}}}}(),i=function(){var n=0;return function(e){e=e||{};var a=e.onFoundPrivateButton||function(){},c=e.onFoundPublicButton||function(n,e){},r=e.onButtonConnected||function(n,e){},i=e.onCompleted||function(n,e,t){},d=n++,u=null,s=null;this._getId=function(){return d},this._attach=function(n){n.sendCommand(t.CreateScanWizard,{scanWizardId:d})},this._detach=function(n){n.sendCommand(t.CancelScanWizard,{scanWizardId:d})},this._onEvent=function(n,e){switch(n){case o.ScanWizardFoundPrivateButton:a();break;case o.ScanWizardFoundPublicButton:u=e.bdAddr,s=e.name,c(u,s);break;case o.ScanWizardButtonConnected:r(u,s);break;case o.ScanWizardCompleted:var t=u,d=s;u=null,s=null,i(e.result,t,d)}}}}(),d=function(n){var e=new a(n),c=this,r={},i={},d={},u=[],s=[];e.onWsOpen=function(n){c.onReady()},e.onWsClose=function(n){c.onClose()},e.onEvent=function(n,e){switch(n){case o.AdvertisementPacket:r[e.scanId]&&r[e.scanId]._onEvent(n,e);break;case o.CreateConnectionChannelResponse:case o.ConnectionStatusChanged:case o.ConnectionChannelRemoved:case o.ButtonUpOrDown:case o.ButtonClickOrHold:case o.ButtonSingleOrDoubleClick:case o.ButtonSingleOrDoubleClickOrHold:if(d[e.connId]){var t=d[e.connId];(n==o.CreateConnectionChannel&&"NoError"!=e.error||n==o.ConnectionChannelRemoved)&&(delete d[e.connId],t._detached()),t._onEvent(n,e)}break;case o.NewVerifiedButton:c.onNewVerifiedButton(e.bdAddr);break;case o.GetInfoResponse:var a=u.shift();a(e);break;case o.NoSpaceForNewConnection:c.onNoSpaceForNewConnection(e.maxConcurrentlyConnectedButtons);break;case o.GotSpaceForNewConnection:c.onGotSpaceForNewConnection(e.maxConcurrentlyConnectedButtons);break;case o.BluetoothControllerStateChange:c.onBluetoothControllerStateChange(e.state);break;case o.GetButtonUUIDResponse:var a=s.shift();a(e.bdAddr,e.uuid);break;case o.ScanWizardFoundPrivateButton:case o.ScanWizardFoundPublicButton:case o.ScanWizardButtonConnected:case o.ScanWizardCompleted:if(i[e.scanWizardId]){var l=i[e.scanWizardId];n==o.ScanWizardCompleted&&delete i[e.scanWizardId],l._onEvent(n,e)}}},this.addScanner=function(n){n._getId()in r||(r[n._getId()]=n,n._attach(e))},this.removeScanner=function(n){n._getId()in r&&(delete r[n._getId()],n._detach(e))},this.addScanWizard=function(n){n._getId()in i||(i[n._getId()]=n,n._attach(e))},this.cancelScanWizard=function(n){n._getId()in i&&n._detach(e)},this.addConnectionChannel=function(n){n._getId()in d||(d[n._getId()]=n,n._attach(e))},this.removeConnectionChannel=function(n){n._getId()in d&&n._detach(e)},this.getInfo=function(n){u.push(n),e.sendCommand(t.GetInfo,{})},this.getButtonUUID=function(n,o){s.push(o),e.sendCommand(t.GetButtonUUID,{bdAddr:n})},this.onReady=function(){},this.onClose=function(){},this.onNewVerifiedButton=function(n){},this.onNoSpaceForNewConnection=function(n){},this.onGotSpaceForNewConnection=function(n){},this.onBluetoothControllerStateChange=function(n){}};e.FlicClient=d,e.FlicCommandOpcodes=t,e.FlicConnectionChannel=c,e.FlicEventOpcodes=o,e.FlicRawWebsocketClient=a,e.FlicScanWizard=i,e.FlicScanner=r},function(n,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),t.d(e,"FlicClient",function(){return a}),t.d(e,"FlicCommandOpcodes",function(){return c}),t.d(e,"FlicConnectionChannel",function(){return r}),t.d(e,"FlicEventOpcodes",function(){return i}),t.d(e,"FlicRawWebsocketClient",function(){return d}),t.d(e,"FlicScanWizard",function(){return u}),t.d(e,"FlicScanner",function(){return s});var o=t(0),a=o.FlicClient,c=o.FlicCommandOpcodes,r=o.FlicConnectionChannel,i=o.FlicEventOpcodes,d=o.FlicRawWebsocketClient,u=o.FlicScanWizard,s=o.FlicScanner}])});
//# sourceMappingURL=index.map